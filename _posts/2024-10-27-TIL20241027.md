---
title: TIL 20241027 - H2 DB의 in-memory 모드 관련 문제
author: rugii913
date: 2024-10-27 20:08:00 +0900
categories: [TIL, 2024년 10월]
tags: [TIL]
render_with_liquid: false
---

## H2 DB의 in-memory 모드 관련 문제

### 발단
- 아직 JPA를 추가하지 않은 프로젝트에서 H2 DB in-memory 모드를 사용하기 위해 data source url을 설정했고
- 콘솔로 해당 url로 접속하려했으나, 오류 메시지만을 볼 수 있었음

### 참고 자료
- [H2 공식 - H2 Database Engine Cheat Sheet](https://www.h2database.com/html/cheatSheet.html)
- [H2 공식 - Features - Connection Modes 부분, Database URL Overview 부분, In-Memory Databases 부분 참고](https://www.h2database.com/html/features.html)
- [H2 공식 - Tutorial - Creating New Databases 부분 참고](https://h2database.com/html/tutorial.html#creating_new_databases)
- 기타 블로그 등
  - [\[Spring Boot\] H2 in memory DB 사용 시 Database "C:/..." not found, either pre-create it or allow remote database creation (not recommended in secure environments) 오류 발생 / 해결 방법](https://djlife.tistory.com/9)
    - 해결책: 빈 database 파일을 직접 생성해두기
  - [\[H2\] Database "mem:testdb" not found, either pre-create it or allow remote database creation 해결](https://shanepark.tistory.com/435)
    - 해결책: (1) 데이터베이스 수동 생성, (2) (JPA 사용 시)더미 entity 생성으로 DB 생성 유도하기
  - [스프링부트 h2인메모리 콘솔 접속](https://malwareanalysis.tistory.com/160)
  - [\[H2\] Database \(디렉토리 경로\) not found, either pre-create it or allow remote database creation](https://bluayer.com/23)
    - 이 사람의 문제는 H2 server mode를 사용할 때와 관련
    - 아마 자동 생성이 막힌 뒤로는 이 방법이 안 될 것
  - [Database not found, and IFEXISTS=true, so we cant auto-create it](https://stackoverflow.com/questions/55349373/database-not-found-and-ifexists-true-so-we-cant-auto-create-it)
    - 답변 중 auto creation 막힌 것 관련 참고
  - [\[Spring Boot\] H2 DB Embedded Mode 사용하기](https://colabear754.tistory.com/193)
    - H2 connection mode 관련 정리
  - [\[Spring boot / h2\] Embedded VS In-Memory VS Server](https://hayden-igm.tistory.com/m/55)
    - H2 connection mode 관련 정리, in-memory mode 관련 정리
  - [Spring boot에서 H2 DB 3가지 모드 사용하기\(embedded, In-Memory, Server\)](https://kukim.tistory.com/105)
      - 작성자 본인이 잘못된 내용이 있다고 함

### 오해했던 것, 알게된 것
- application.yml의 여러 프로퍼티 관련
  - datasource 프로퍼티 부분은 H2 database를 자동으로 생성해주는 것과는 관련이 없다.
  - 마찬가지로 h2 console 프로퍼티 부분 역시 database 자동 생성과는 상관이 없다.
    - 단지 h2 console을 설정해줄 뿐
- JPA를 사용하면서 자동 생성된 h2 in-memory database를 사용했던 것은 JPA의 ddl-auto 때문이다.
- H2의 connection mode는 DB server를 독립적으로 둘지, application과 함께 둘지에 관한 것으로 볼 수 있다.
  - 즉 application과 같은 JVM 위에서 H2 DB를 구동할지, 별도의 JVM을 하나 더 돌릴지에 대한 것이다.
- (아마도?) 1.4.2 버전 이전까지는 console 접속 후 embedded mode url로 connect하는 것만으로 database 자동 생성을 지원했으나, 현재는 지원하지 않는다.
- in-memory mode를 사용할 때에도 외부에서 tcp로 in-memory mode DB에 접근할 수 있다.

### 선택한 해결 방법, 할 수 없어서 아쉬었던 방법
- 선택한 해결 방법
  - 1.4.x 이후로 자동 생성을 지원하지 않는 것을 확인했으므로
  - 수동으로 database 파일을 특정 경로에 생성한 후 해당 경로로 connection을 맺도록 했다.
- 할 수 없어서 아쉬웠던 방법
  - in-memory DB을 미리 생성한 후 접속해보고 싶었는데, 적절한 방법을 찾아내지 못했다.
